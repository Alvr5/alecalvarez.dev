<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Salidas con Firebase</title>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f0f0f0;
    }
    .saludar {
      font-size: 20px;
      padding: 10px 20px;
      border-radius: 30px;
      border: 2px solid black;
      width: max-content;
      font-weight: 200;
      position: absolute;
      left: 80px;
      top: 60px;
      background: white;
    }
    p {
      font-family: sans-serif;
      position: absolute;
      top: 70px;
    }
    .inicioenlace { left: 420px; }
    .galeriaenlace { left: 560px; }
    .logonegro {
      position: absolute;
      left: 680px;
      top: 55px;
      width: 100px;
    }
    .salidasenlace { left: 860px; }
    .gruposenlace { left: 1000px; }

    .tituloproximassalidas {
      padding: 20px;
      position: relative;
      top: 150px;
      left: 60px;
      width: 1410px;
    }
    .textoproximassalidas {
      font-size: 30px;
      font-weight: bold;
      font-family: sans-serif;
    }

    .salidas ul {
      margin-top: 20px;
      padding-left: 0;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      list-style: none;
    }
    .salidas ul li {
      position: relative;
      width: 250px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 0 15px #00000042;
      background: white;
    }
    .salidas ul li img {
      width: 100%;
      display: block;
      border-radius: 20px;
    }
    /* Overlay with text */
    .salida-container {
      position: relative;
    }
    .salida-container img {
      display: block;
      border-radius: 20px;
      width: 100%;
    }
    .overlay {
      position: absolute;
      bottom: 0;
      background: rgba(0,0,0,0.6);
      color: white;
      width: 100%;
      padding: 10px;
      box-sizing: border-box;
      border-radius: 0 0 20px 20px;
      font-size: 14px;
    }
    .overlay .titulo {
      font-weight: bold;
      font-size: 16px;
      margin: 0 0 5px 0;
    }
    .overlay .subtitulo {
      margin: 0;
      font-size: 13px;
      font-weight: normal;
    }

    #botoncrear {
      position: relative;
      top: 170px;
      left: 60px;
      padding: 10px 25px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      border: 2px solid black;
      background: white;
      font-weight: bold;
    }
    #botoncrear:hover {
      background: black;
      color: white;
      transition: 0.3s;
    }

    /* Formulario emergente */
    #formulario {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px 30px;
      border-radius: 10px;
      box-shadow: 0 0 25px rgba(0,0,0,0.3);
      z-index: 100;
      width: 320px;
    }
    #formulario label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
    }
    #formulario input[type="text"],
    #formulario input[type="date"],
    #formulario input[type="file"] {
      width: 100%;
      padding: 7px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    #formulario button {
      margin-top: 15px;
      padding: 10px 20px;
      border: none;
      background: black;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      width: 100%;
    }
    #formulario button:hover {
      background: #222;
    }
    #cerrarFormulario {
      position: absolute;
      top: 5px;
      right: 10px;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      color: #666;
    }
    #cerrarFormulario:hover {
      color: black;
    }
  </style>
</head>
<body>
  <h1 id="saludo" class="saludar">Hola!</h1>

  <p class="inicioenlace" style="left:420px;">Inicio</p>
  <p class="galeriaenlace" style="left:560px;">Galeria</p>
  <img src="assets/logonegro.png" class="logonegro" alt="Logo Negro">
  <p class="salidasenlace" style="left:860px;">Salidas</p>
  <p class="gruposenlace" style="left:1000px;">Grupos</p>

  <div class="tituloproximassalidas">
    <p class="textoproximassalidas">Próximas Salidas</p>
  </div>

  <button id="botoncrear">Crear</button>

  <div class="salidas">
    <ul></ul>
  </div>

  <!-- Formulario emergente -->
  <div id="formulario">
    <span id="cerrarFormulario">&times;</span>
    <h3>Crear nueva salida</h3>
    <label for="nombreSalida">Nombre:</label>
    <input type="text" id="nombreSalida" placeholder="Nombre de la salida" />

    <label for="fechaSalida">Fecha:</label>
    <input type="date" id="fechaSalida" />

    <label for="imagenSalida">Selecciona imagen:</label>
    <input type="file" id="imagenSalida" accept="image/*" />

    <button id="guardarBtn">Guardar</button>
  </div>

  <script>
    // Tu configuración Firebase - ¡pon aquí la tuya!
    const firebaseConfig = {
    apiKey: "AIzaSyCHTXXIXmEWsTbvOKtarjhc3_C4WYW1wFg",
  authDomain: "modify-f9b1c.firebaseapp.com",
  projectId: "modify-f9b1c",
  storageBucket: "modify-f9b1c.appspot.com",
  messagingSenderId: "681418689727",
  appId: "1:681418689727:web:e7d3766394fd772a814a0a"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Obtener usuario de URL ?usuario=...
    const params = new URLSearchParams(window.location.search);
    const nombreUsuario = params.get("usuario");

    document.addEventListener("DOMContentLoaded", () => {
      // Mostrar saludo personalizado
      const saludo = document.getElementById("saludo");
      if (nombreUsuario) {
        saludo.textContent = `Hola, ${nombreUsuario}!`;
      }

      const botoncrear = document.getElementById("botoncrear");
      const formulario = document.getElementById("formulario");
      const cerrarFormulario = document.getElementById("cerrarFormulario");
      const guardarBtn = document.getElementById("guardarBtn");
      const ul = document.querySelector(".salidas ul");

      let imagenBase64 = null;

      botoncrear.addEventListener("click", () => {
        formulario.style.display = "block";
      });

      cerrarFormulario.addEventListener("click", () => {
        formulario.style.display = "none";
        resetForm();
      });

      // Leer imagen y convertir a base64
      document.getElementById("imagenSalida").addEventListener("change", function () {
        const file = this.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            imagenBase64 = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      function resetForm() {
        document.getElementById("nombreSalida").value = "";
        document.getElementById("fechaSalida").value = "";
        document.getElementById("imagenSalida").value = "";
        imagenBase64 = null;
      }

      guardarBtn.addEventListener("click", async () => {
        const nombre = document.getElementById("nombreSalida").value.trim();
        const fecha = document.getElementById("fechaSalida").value;

        if (!imagenBase64 || !nombre || !fecha) {
          alert("Faltan datos. Por favor, sube una imagen y completa todos los campos.");
          return;
        }

        const nombreSalidaUsuario = `Salida de ${nombreUsuario || "Anónimo"}`;

        const salida = {
          nombre: nombreSalidaUsuario,
          fecha,
          autor: nombreUsuario || "Anónimo",
          imagen: imagenBase64,
          timestamp: new Date()
        };

        try {
          await db.collection("salidas").add(salida);

          const li = document.createElement("li");
          li.innerHTML = `
            <div class="salida-container">
              <img src="${imagenBase64}" alt="Imagen subida" />
              <div class="overlay">
                <p class="titulo">${nombreSalidaUsuario}</p>
                <p class="subtitulo">${fecha} — Creado por: ${salida.autor}</p>
              </div>
            </div>
          `;
          ul.appendChild(li);

          formulario.style.display = "none";
          resetForm();
        } catch (error) {
          console.error("Error al guardar en Firebase:", error);
          alert("Error al guardar. Intenta de nuevo.");
        }
      });
    });
  </script>
</body>
</html>
